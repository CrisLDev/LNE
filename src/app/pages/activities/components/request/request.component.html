<h3 class="mt-2 mb-2">Tratamientos</h3>
<ng-container *ngIf="treatments?.length > 0; else noTreatments">
  <div class="form-group mb-2">
    <input type="text" class="form-control" placeholder="Buscar por email..." name="filterTreatment" [(ngModel)]="filterTreatment" spellcheck="false" autocomplete="none">
  </div>
    <div class="col-xl-12 mt-2" *ngFor="let treatment of treatments | treatment:filterTreatment | paginate:{ itemsPerPage: 3, currentPage: r};">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{treatment.name}} {{treatment.last}}</h5>
                <p>Tipo de plan <span class="font-weight-bold">{{treatment.plan}}</span></p>
                <p>Solicitante: <span class="font-weight-bold">{{treatment.email}}</span></p>
                <button class="btn btn-block btn-danger" (click)="deleteTreatment(treatment._id)">Eliminar</button>
                <button class="btn btn-block btn-info" id="responseButton" data-toggle="modal" data-target="#responseRequestModal" (click)="responseTreatment(treatment._id, treatment.email)">Responder</button>
            </div>
        </div>
    </div>
    <div class="mt-3">
        <pagination-controls (pageChange)="r = $event"></pagination-controls>
    </div>
</ng-container>

<ng-template #noTreatments>
    <div class="text-center" style="margin-top: 70px;" id="spinnerTreatments">
        <div
          class="spinner-border"
          style="width: 3rem; height: 3rem;"
          role="status"
        >
          <span class="sr-only">Loading...</span>
        </div>
    </div>
    <div class="mt-5 mb-5 text-center d-none" id="noTreatmentsdiv">
        <h3>No hay tratamientos</h3>
    </div>
  </ng-template>

  <!-- Modal -->
<div class="modal fade" id="responseRequestModal" tabindex="-1" aria-labelledby="responseRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="responseRequestModalLabel">Enviar Respuesta</h5>
          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"><svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
          </svg></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="treatmentForm" (submit)="request()" novalidate>
            <div class="mb-3">
              <label for="subjectRequestInput" class="form-label">Asunto</label>
              <input type="text" class="form-control" id="subjectRequestInput" minlength="6" maxlength="40" formControlName="title">
              <div *ngIf="f.title.invalid && (f.title.dirty || f.title.touched)"
              class="alert alert-danger">
              <div *ngIf="f.title.errors.required">
                Información requerida.
              </div>
              <div *ngIf="f.title.errors.minlength">
                El campo debe contener más de 6 caracteres.
              </div>
              <div *ngIf="f.title.errors.maxlength">
                El campo debe contener más de 40 caracteres.
              </div>
              <div *ngIf="f.title.pending">Validando...</div>
            </div>
            </div>
            <div class="mb-3">
              <label for="contentRequestTextarea" class="form-label">Conternido de la respuesta</label>
              <textarea class="form-control" id="contentRequestTextarea" rows="3" minlength="6" formControlName="content"></textarea>
              <div *ngIf="f.content.invalid && (f.content.dirty || f.content.touched)"
              class="alert alert-danger">
              <div *ngIf="f.content.errors.required">
                Información requerida.
              </div>
              <div *ngIf="f.content.errors.minlength">
                El campo debe contener más de 6 caracteres.
              </div>
              <div *ngIf="f.content.pending">Validando...</div>
            </div>
            </div>
            <button type="submit" class="btn btn-primary btn-block" [disabled]="treatmentForm.invalid">Enviar</button>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-block mr-3" id="closeModal" data-dismiss="modal" >Cerrar</button>
        </div>
      </div>
    </div>
  </div>
